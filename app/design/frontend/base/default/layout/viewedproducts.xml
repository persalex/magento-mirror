<layout version="0.1.0">
    <default>
        <reference name="head">
            <action method="addJs" ifconfig="catalog/js_viewed_products/allow_jsblock">
                <script>local/storage.js</script>
            </action>
        </reference>
        <reference name="right.reports.product.viewed">
            <action method="setTemplate" ifconfig="catalog/js_viewed_products/allow_jsblock">
                <template>viewedproducts/products_viewed.phtml</template>
            </action>
        </reference>
    </default>
    <catalog_category_layered_nochildren translate="label">
        <reference name="left.reports.product.viewed">
            <action method="setTemplate" ifconfig="catalog/js_viewed_products/allow_jsblock">
                <template>viewedproducts/products_viewed.phtml</template>
            </action>
        </reference>
    </catalog_category_layered_nochildren>
    <catalog_product_view>
        <block type="core/template" name="product_data_gatherer" template="viewedproducts/gatherer.phtml" />
        <reference name = "content">
            <action method="append" ifconfig="catalog/js_viewed_products/allow_jsblock">
                <block>product_data_gatherer</block>
            </action>
        </reference>
    </catalog_product_view>
</layout>